### 3D vid (stereo vid)

- prej smo vedno gledali $u,v$ koordinate slike
- ljudje vidimo 3D, ker imamo dve očesi:
	- tudi če zamižimo, vidimo oddaljenost, ker smo tako naučeni in nam možgani avtomatsko pomagajo

- prej smo šli iz 3D v 2D; zdaj hočemo iz 2D v 3D
- če imamo samo eno sliko, ne moremo iti enolično iz (x,y) v (X,Y,Z)
- več točk na premici je kandidatov za ustrezen (X,Y,Z)
- rabimo dve kameri, da bomo imeli več parametrov kot neznank

Anamorfoza:
- iz različnih zornih kotov nam izgleda, kot da je 3D objekt, čeprav je zares 2D slika

- obe kameri morata biti nekako povezani - morata gledati isto točko
- korespondenca - kateri piksel leve in desne slike predstavljata isti element v svetu
- rekonstrukcija - če poznam pare $(x_l, y_l), (x_r, y_r)$, kako potem izračunamo, katera točka je to v realnem svetu

- predpostavimo, da sta kameri vzporedni - v realnosti jih rabimo kalibrirati, da postaneta vzporedni
- $b$ = baseline = razdalja med kamerama
- dispariteta = kakšna je razlika med koordinatami točke na levi in desni sliki; večja kot je dispariteta, manjši je $Z$ (bližje je predmet)
- če je predmet neskončno daleč, potem je dispariteteta 0 (preslika se v isti piksel na obeh slikah)

- da skalibriramo $f$ in $b$ rabimo nek kalibracijski vzorec, kjer vemo X,Y,Z
- $f$ nam vsaj približno pove že proizvajalec
- $b$ se ne spreminja - kameri sta fiksni relativno na drugo; sta vedno enako oddaljeni

- gosti stereo - za vse piksle želimo izračunati korespondenčne pare na drugi sliki
- redki stereo - izberemo si nekaj točk, za katere poiščemo korespondenco

- večina toččk na sceni je vidnih z obeh pogledov
- dva podproblema - katere elemente med slikami primerjati in kako primerjati
- katere elemente:
	- lahko iščemo vse piksle ali določene točke (npr. vogale, korespondenčne točke, vrh gore)
	- z geometrično omejitvijo omejimo, kje iskati eno točko na drugi sliki
- kako primerjati:
	- ujemanje slik s korelacijskimi metodami (gremo s patchom po celi sliki in gledamo, kje se najbolj ujema)
	- lahko iščemo značilke

Geometrične omejitve:
- ker sta kameri na isti osi, se mora nek element nahajati v isti vrstici pri obeh kamerah
- ne rabimo iskati patchev po celi sliki, ampak samo v eni vrstici
- glede stolpcev lahko tudi gledamo samo bližnje stolpce - pri tem bomo ignorirali predmete, ki so zelo blizu (imajo zelo veliko dispariteto)
- nobena kamera v praksi ni vzporedna, zato rabimo sliki transformirati tako, da izgledata vzporedni
- tudi če kameri nista vzporedni, iščemo točke na neki premici, ampak ta premica ni več vodoravna - epipolarna omejitev:
	- ![500](../../Images4/Pasted%20image%2020251219094223.png)
	- slikovna ravnina je narisana z modro; narisana je pred lečo, čeprav je zares za lečo (zrcaljeno prek leče)
	- rabimo narediti epipolarno premico - premica, ki gre od gorišča do našega piksla
	- epipol = premica, ki povezuje optična centra do presečišča s slikovno ravnino
	- $e_L$, $e_R$ = epipolarni točki
	- ko imamo modro in zeleno ravnino, potem iščemo korespondenčno točko samo na premici, kjer se zelena in modra ravnina sekata na drugi sliki
	- zelen trikotnik je definiran z epipolom in $x_L$

Homografija:
- homogen transformacija $H$, ki eno ravnino preslika v drugo (za vsako točko v eni ravnini nam pove, kam se preslika na drugi ravnini)
- slika je planarna (je na ravnini)
- potem dobimo sliki, ki sta kot da bi bili vzporedni in lahko iščemo korespondenčne pare točk po vrsticah, namesto po postrani črtah
- dva pogleda na isti ravninski (ploščat) predmet (preslikava iz ravnine na ravnino)
- štirje pari točk so dovolj, da bomo dobili pravilno preslikavo tudi za vse ostale točke
- pri izbiranju točk, ki jih želimo preslikati, dobimo malo šuma (malo se zmotimo), ampak se potem to izniči, ko gledamo vse štiri točke
- v bistvu z direktno linearno transformacijo (DLT) izračunaš 3x3 matriko $H$

Primerjanje delov slik:
- dva načina:
	- primerjaš značilke (robovi, vogali, SIFT)
- korelacijske metode:
	- primerjamo dva patcha slike med sabo s pomočjo korelacije
	- problem: če imamo npr. veliko pikic skupaj, ne bomo vedeli, katera pikica se preslika v katero

Gosti stereo:
- ker leva kamera ne vidi vsega, kar vidi desna, dobimo nek del slike, za katerega ne moremo narediti preslikave, zaradi paralakse kamer

- fundamentalna matrika - sliki nam poravnava tako, kot če bi bili kameri vzporedni

Moramo poznati parametre kamere:
- notranji parametri kamere:
	- goriščna razdalja $f$
	- središčna točka - samo premaknemo koordinatni sistem tako, da je izhodišče na sredini slike
	- merilo pikslov:
		- ali so kvadratni ali so pravokotni (rabimo vedeti razmerje med dolžino in širino)
	- sheer = nagib - če so piksli postrani, jih poravna
	- kalibracijska plošča:
		- za vsako točko poznaš (X,Y,Z) in pogledaš, kam se to preslika v (x,y) => s tem greš v formulo x = -fX/Z in izračunaš kakšen $f$ imaš
		- izračunamo tako $f$, ki nam bo pri tej množici enačb minimiziral napako pri preslikavi (X,Y,Z) v (x,y)
		- tako dobimo celo $K$ kalibracijsko matriko
		- $f$ je najpomembnejši pri $K$ matriki
	- radialna distorzija:
		- zaradi leče se ravne črte ukrivijo
		- v središču leče imamo natančno projekcijo, na robovih pa se ravne črte ukrivijo
		- nimamo več linearnega modela
		- dlje kot je piksel od centra, bolj bo izgledal drugačen, kot bi moral
		- lahko dodamo še nekaj koeficientov, s katerimi spravimo piksle iz roba proti sredini, da izvemo, kje bi jih morali videti na sliki
		- distorzijski parametri - radialni in tangencialni
		- tangencialni = če slikovna ravnina ni pravokotna na lečo?
		- pri fisheye so ljudje na robih bolj debeli, na sredini pa bolj suhi - moramo to pokompenzirati z odpravljanjem radialne distorzija
	- notranji parametri so odvisni od kamere, kakšna je leča, celice za zaznavanje itd.
	- ko enkrat skalibriramo kamero, bomo vedno uporabili iste parametre
- zunanji parametri kamere:
	- lega kamere v svetu
	- kje se KS kamere nahaja v KS sveta
	- imamo matriko za rotacijo in translacijo, da pridemo iz enega KS v drugega
- dobimo $f$ in $b$ kot parametra stereo kamer

Geometrija iz več točk:
- kaj če eno točko vidiš na več slikah (npr. na petih slikah)
- če imamo rigidno namontirane kamere:
	- z večjo natančnostjo lahko poračunaš globino točke

Struktura iz gibanja:
- ko imaš robota, ki se vozi okoli, se lokaliziraš in mapiraš (moraš vedeti, kje na mapi si in kaj vidiš)

Depth from defocus:
- ko spremijaš goriščno razdaljo, bodo različni deli slike v fokusu in iz tega lahko približno dobiš globino

- lahko imamo namesto dveh kamer tudi en projektor in eno kamero - projektor ti riše neke črte iz katerih zna kamera prebrati globino:
	- na tak način dela xbox kinnect
	- tipično projeciraš IR svetlobo, da človek ne vidi
	- ta vir svetlobe ti pomaga pri homogenih površinah, da izračunaš kot, pod katerim gleda predmet na kamero
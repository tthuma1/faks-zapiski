- opravil ne kličemo, ampak jih bo zagnal razvrščevalnik tako, da se bo vračal iz ISR:
	- ISR pobere shranjeno stanje v katerega se želi vrniti - hardware stack frame (HSF)
	- zato rabimo za vsako od opravil na skladu prednastaviti pravilne vrednosti za PC in PSR
- `TaskCreate` - naredi TCB za vsako opravilo
- `TaskInit` - napolni HSF
- TCB-jev je toliko, kot opravil
- za ničto opravilo ne rabimo prednastaviti HSF, ker ga bomo zagnali z navadnim `call`
- opravila so implementirana v neskončni zanki, ker se ne smejo sama od sebe zaključiti
- skladi opravil so omejeni, nobeno opravilo nima neskončnega sklada:
	- nevarno za rekurzivne klice

- ko kličemo Task0, se bo procesor ujel v njem - rabimo prekiniti opravilo s prekinitvijo (interrupt)
- kdo bo prekinjal - sistemski časovnik:
	- ima nek števec, ki vsako urino periodo zmanjša svojo vrednost in ko pride do 0, se sproži prekinitev in se ponastavi nazaj na tisto vrednost, na kateri je začel
	- se nastvi že v `HAL_Init()`
- ob prekinitvi se shrani kontekst opravila na sklad
- iz ISR se vračamo tako, da preberemo vrednosti s sklada, ki pripadajo naslednjemu opravilu
- ISR pišemo v `stm32h7xx_it.c`:
	- npr. hard fault ISR se proži ob napaki v CPU (neveljaven ukaz, dostop do neporavnanih naslovov) in se ujame v neskončno zanko
	- `SysTick_Handler`

- da vemo, na katerem opravilu smo, bomo uporabili števec `int current_task`:
	- prevajalnik ne ve, kdaj se bo spremenljivka spremenila
	- če prevajalnik ne ve, kdaj se bo spremenljivka spremenila, jo bo dal v en register v CPU (za pogosto uporabljene spremenljivke lahko rezervira en register)
	- če bo to spremenljivko spreminjal nek ISR, prevajalnik tega ne bo vedel, zato ne bomo videli, da se je spremenila
	- spremenljivke, ki jih lahko spreminjajo neke V/I enote ali ISR rabimo označiti, naj je ne hrani v registru, ampak jo vedno spreminja v pomnilniku - `volatile int current_task`
	- `volatile` = vedno spreminjaj/beri vrednost spremenljivke iz pomnilnika

Funkcija ContextSwitch:
- 1. shrani PSP prekinjenega opravila v njegov TCB
- 2. določi indeks naslednjegaa opravila
- 3. zamenjava stack pointerja - preberi v PSP skladovni kazalec iz TCB novega opravila
